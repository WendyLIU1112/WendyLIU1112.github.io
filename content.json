{"meta":{"title":"Wendy的博客","subtitle":"1585282623@qq.com","description":"hhh","author":"Liu Wenli","url":"https://wendyliu1112.github.io","root":"/"},"pages":[],"posts":[{"title":"写R包可能出现的问题","slug":"r包问题","date":"2019-12-26T08:18:15.000Z","updated":"2020-01-18T17:51:25.591Z","comments":true,"path":"2019/12/26/r包问题/","link":"","permalink":"https://wendyliu1112.github.io/2019/12/26/r%E5%8C%85%E9%97%AE%E9%A2%98/","excerpt":"最近学习写R包，参考博客：如何快速写一个R包。根据该博客教程写R包非常简单，补充我遇到的两个小问题。","text":"最近学习写R包，参考博客：如何快速写一个R包。根据该博客教程写R包非常简单，补充我遇到的两个小问题。 1. document（）后显示未加载包写入函数前需要先加载所写的包1libray(所写的包) 2. document（）后显示namespace不是由roxygen2生成的 The existing ‘NAMESPACE’ file was not generated by roxygen2 自动生成的namespace文件只有一行代码，不是由roxygen2生成的，需要修改，将其替换为以下代码 123456789101112#Generated by roxygen2 (4.0.2): do not edit by handS3method(as.character,expectation)S3method(compare,character)export(auto_test)export(auto_test_package)export(colourise)export(context)exportClasses(ListReporter)exportClasses(MinimalReporter)importFrom(methods,setRefClass)useDynLib(testthat,duplicate_)useDynLib(testthat,reassign_function) 后续想学习的博客：开发 R 程序包之忍者篇","categories":[{"name":"technique","slug":"technique","permalink":"https://wendyliu1112.github.io/categories/technique/"}],"tags":[{"name":"R包","slug":"R包","permalink":"https://wendyliu1112.github.io/tags/R%E5%8C%85/"}]},{"title":"【文献综述】估计最优ITR的方法","slug":"估计最优ITR","date":"2019-12-26T08:18:15.000Z","updated":"2020-01-18T17:50:41.730Z","comments":true,"path":"2019/12/26/估计最优ITR/","link":"","permalink":"https://wendyliu1112.github.io/2019/12/26/%E4%BC%B0%E8%AE%A1%E6%9C%80%E4%BC%98ITR/","excerpt":"由于许多疾病和不同患者对治疗的反应均不相同，因此有必要对患者进行个体化治疗（即精准医疗）。个性化治疗规则（individiualized treatment rule，ITR）是根据患者特征推荐治疗的决策规则。在当前精准医疗的要求下，针对每个病","text":"由于许多疾病和不同患者对治疗的反应均不相同，因此有必要对患者进行个体化治疗（即精准医疗）。个性化治疗规则（individiualized treatment rule，ITR）是根据患者特征推荐治疗的决策规则。在当前精准医疗的要求下，针对每个病人的信息使用不同的治疗方案，推荐最优ITR非常重要。主要思想是基于个体信息（如临床协变量、基因等），最大化群体平均的outcome（如事件发生时间、健康指标、疾病指标等）。 这里作为入门，介绍了当前估计optimal ITR的框架与几种主要方法。 框架相关数据三元随机向量 $(\\mathbf{x}, A, R)$其中，协变量： $\\mathbf{x}=\\left(1, X{1}, \\cdots, X{p}\\right) \\in \\mathcal{X}$&emsp;&emsp;&emsp;治疗方案(treatment)：$A \\in{1,2, \\cdots, K}$&emsp;&emsp;&emsp;治疗效果(outcome)：$R$。 假设$R$有界，且$R$越大代表治疗效果越好。 先验概率分布 $\\pi(a, x)=P[A=a|\\mathbf{x}=x]$ 已知（未知时可用多项logistic回归近似）。并假设对于所有$a\\in\\mathcal{A}$ ， $\\pi(a,x)&gt;0$ a.s。 样本 $\\left{\\left(\\mathbf{x}{i}, A{i}, R_{i}\\right), i=1, \\cdots, n\\right}$ i.i.d Target 决策函数 (ITR)： $d(\\mathbf{x}): \\mathcal{X} \\rightarrow \\mathcal{A}$ $d$ 的值（Value）：$V(d) \\triangleq E^{d}(R)=\\int R d P^{d}=\\int R \\frac{d P^{d}}{d P} d P=E\\left[\\frac{1_{A=d(\\mathbf{x})}}{\\pi(A, \\mathbf{x})} R\\right]$&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;其中，$P$：$(\\mathbf{x}, A, R)$的分布&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$P^{d}$：$d$指定治疗方案下，$(\\mathbf{x}, A, R)$的分布 最优 ITR：$d{0} \\in \\arg \\max {d \\in \\mathcal{A}} V(d)$即如果患者群体遵循该方案，则将产生平均情况下最有利的结果。 介绍治疗主要分为单阶段治疗和动态治疗（dynamic treatment regime）。 对于单阶段治疗，只需要一次治疗，所以只需在某个关键点制定治疗规则。而动态治疗更为复杂且更有意义。在临床实践中，医生会根据患者的基线和不断发展的特点对患者的病程推荐一系列的治疗方案。所以，动态治疗机制是一列有序治疗规则，每个规则对应于疾病或紊乱过程中的关键决策点，并以患者在该点的信息作为输入，从可选项中输出他应接受的治疗。 另外，通常有许多预处理变量（prescriptive variables/pretreatment variables）可能对构建最优 ITR 不起作用，且出于成本和可解释性的考虑，最优 ITR 仅应使用少数几个变量，所以需要变量选择，这里不做讨论。 对于单阶段随机试验数据，一种方法是，在一类治疗规则下最大化平均响应的经验版本。但是，这种最大化在计算上是困难的（因为处理规则的平均响应是对加权示性函数的期望，示性函数对于参数不连续且不凹）。为了解决这一挑战，我们进行了替代。所以另一种方法（也是我们最常用的方法）是，使用两步过程，首先估计条件均值，然后最大化条件均值得出最优ITR的估计。这种方法依赖于outcome的条件均值的估计，强调了临床响应模型的预测准确性，而不是直接针对最优ITR的决策边界。 初步分析 协变量低维且ITR类简单时直接构造$E\\left[\\frac{1{A=d(\\mathbf{x})}}{\\pi(A, \\mathbf{x})} R\\right]$的经验形式，对其最大化求 $d{0}$（鉴于示性函数非凸非连续，不好做） ITR类很大使用两步过程（Two-step procedure）（1）估计条件均值$Q{0}$(或$T{0}$)（2）最大化前一步所得的估计量求 $d_{0}$ 其中， quality: $Q{0}(\\mathbf{x}, A) \\triangleq E(R | \\mathbf{x}, A)$&emsp; &emsp;&emsp;prediction error of Q: $L(Q) \\triangleq E[R-Q(X, A)]^{2}$&emsp; &emsp;&emsp;treatment effect term: $T(X, A) \\triangleq Q(X, A)-E[Q(X, A) | X]$&emsp; &emsp;&emsp;true treatment effect term: $T{0}(X, A) \\triangleq Q{0}(X, A)-E[Q{0}(X, A) | X]$ &emsp; $\\because$ $V(d)=E\\left[\\frac{1{A=d(\\mathbf{x})}}{\\pi(A, \\mathbf{x})} Q{0}(\\mathbf{x}, A)\\right]=E\\left[\\sum{a \\in \\mathcal{A}} 1{d(\\mathbf{x})=a} Q{0}(\\mathbf{x}, a)\\right]=E\\left[Q{0}(\\mathbf{x}, d(\\mathbf{x}))\\right]$ &emsp; &emsp; $V\\left(d{0}\\right)=E\\left[Q{0}\\left(\\mathbf{x}, d{0}(\\mathbf{x})\\right)\\right] \\leq E\\left[\\max {a \\in \\mathcal{A}} Q{0}(\\mathbf{x}, a)\\right]$&emsp; &emsp; $V\\left(d{0}\\right) \\geq\\left.V(d)\\right|{d(\\mathbf{x}) \\in \\arg \\max {a \\in \\mathcal{A}} Q{0}(X, a)}=E\\left[\\max {a \\in \\mathcal{A}} Q_{0}(\\mathbf{x}, a)\\right]$ &emsp; $\\therefore$ $d{0}(\\mathbf{x}) \\in \\arg \\max {a \\in \\mathcal{A}} Q{0}(\\mathbf{x}, a)= \\arg \\max {a} T_{0}(\\mathbf{x}, a)$ 所以，为了解决$V(d)$的非凸和非连续性，大多数方法都是将最大化$V(d)$ 转化为最大化 $Q{0}$ 和 $T{0}$ 分类基于模型（model-based）基于模型的方法主要有 $l_{1}-PLS$、Q learning和A learning，其中后两种方法都是CS中顺序决策的强化学习方法，应用到治疗过程实现动态治疗机制。 经典做法是对$Q{0}$(或$T{0}$)指定假设模型，极小化$L(Q)$，做$Q{0}$(或$T{0}$)的估计，如 $l{1}-PLS$ :&emsp; &emsp;&emsp; &emsp; $\\hat{\\boldsymbol{\\theta}}{n}=\\underset{\\boldsymbol{\\theta} \\in \\mathbb{R}^{J}}{\\arg \\min }\\left{E{n}[R-\\Phi(\\mathbf{x}, A) \\boldsymbol{\\theta}]^{2}+\\lambda{n} \\sum{j=1}^{J} \\hat{\\sigma}{j}\\left|\\theta{j}\\right|\\right}$&emsp; &emsp;&emsp; &emsp; $\\hat{d}{n}(X) \\in \\underset{a \\in \\mathcal{A}}{\\arg \\max } \\Phi(X, a) \\hat{\\boldsymbol{\\theta}}_{n}$ 基于分类（classification-based）基于分类的方法是将最优 ITR 问题转化为加权分类问题，便于使用机器学习技术做估计。这里直接估计使临床反应最大化的决策规则，从而避免了条件均值建模和反演的需要。缺点是依赖于对所有对象使用正确的权重，这可能会导致模型错误指定。 &emsp; &emsp;首先令$K=2$，即$A \\in{-1,1}$ &emsp; &emsp; $\\because$ $d{0} \\in \\arg \\max {d \\in \\mathcal{A}} V(d)$&emsp; &emsp;&emsp; $\\begin{aligned} V(d) = &amp;E\\left[\\frac{1{A=d(\\mathbf{x})}}{\\pi(A, \\mathbf{x})} R\\right]= E\\left[\\frac{1{A=d(\\mathbf{x})}}{A \\pi+(1-A) / 2} R\\right]\\=&amp;E[R | A=1]+E[R | A=-1]-E\\left[\\frac{I(A \\neq \\mathscr{d}(\\mathbf{x}))}{A \\pi+(1-A) / 2} R\\right] \\end{aligned}$&emsp; &emsp; $\\therefore$ $d{0} \\in \\arg \\min {d \\in \\mathcal{A}} E\\left[\\frac{I(A \\neq \\mathscr{d}(\\mathbf{x}))}{A \\pi+(1-A) / 2} R\\right]$ $E\\left[\\frac{R}{A \\pi+(1-A) / 2} I(A \\neq \\mathscr{d}(X))\\right]$可看作加权分类误差，基于$X$将$A$分类，并对误判事件加权$R / (A \\pi+(1-A) / 2)$。利用其经验形式，应用机器学习技术，即可直接算出最优ITR的估计。 直接搜索（Direct search）直接搜索，顾名思义，直接对 $d_{0}$ 做估计。其中，直接学习（Direct learning）是一种简单而灵活的单步方法，直接估计最优 ITR。无需事先指定模型和权重，同时还有良好的几何解释。 直接学习最开始考虑治疗方案为二分类的数据，即$K=2$。但推广到$K \\geq 2$时，可能会导致次优（局部最优）的情况，所有有了基于角的直接学习(Angle Based D-learning)， $K=2$：一般直接学习 此时，$A \\in{-1,1}$ 决策函数：$d{0}(\\mathbf{x})=\\operatorname{sign}(\\mathbf{E}[R | \\mathbf{x}, A=1]-\\mathbf{E}[R | \\mathbf{x}, A=-1]):=\\operatorname{sign}\\left(f{0}(\\mathbf{x})\\right)$其中， $\\begin{aligned} f{0}(\\mathbf{x}) &amp;=\\mathbf{E}[R | \\mathbf{x}, A=1]-\\mathbf{E}[R | \\mathbf{x}, A=-1] \\ &amp;=\\mathbf{E}\\left[\\frac{R A}{\\pi(A, \\mathbf{X})} | \\mathbf{x}, A=1\\right] \\pi(1, \\mathbf{x})+\\mathbf{E}\\left[\\frac{R A}{\\pi(A, \\mathbf{x})} | \\mathbf{x}, A=-1\\right] \\pi(-1, \\mathbf{x}) \\ &amp;=\\mathbf{E}\\left[\\frac{R A}{\\pi(A, \\mathbf{x})} | \\mathbf{x}\\right] \\end{aligned}$接下来估计$f{0}(\\mathbf{x})$即可。 $K \\geq 2$ ：基于角的直接学习（AD learning） $\\mathbf{w}{A}=\\left{\\begin{array}{ll} {(K-1)^{-1 / 2} \\mathbf{1}{K-1}} &amp; {\\text{if} \\quad A=1} \\ {-(1+\\sqrt{K}) /(K-1)^{3 / 2}} {\\mathbf{1}{K-1}+\\left(\\frac{K}{K-1}\\right)^{1 / 2} e{A-1}} &amp; {\\text {if } \\quad2 \\leq A \\leq K} \\end{array}\\right.$ &emsp;&emsp;&emsp;(1) $\\mathbf{P}\\left[\\mathbf{w}=\\mathbf{w}{j} | \\mathbf{x}\\right]=\\mathbf{P}[A=j | \\mathbf{x}]$&emsp;&emsp;&emsp;(2) $\\sum{j=1}^{K} \\mathbf{w}{j}=0$且 $\\mathbf{w}{i}^{T} \\mathbf{w}_{j}=\\left{\\begin{array}{ll} 1 &amp; {\\text{if} \\quad i = j} \\ C(K)&lt; 1 &amp; {\\text {if} \\quad i \\neq j} \\end{array}\\right.$ &emsp;&emsp;&emsp;决策函数：&emsp;&emsp;&emsp;$\\begin{aligned} d{0}(\\mathbf{x}) = &amp; \\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}} \\mathbf{E}[R | \\mathbf{x}, A=k] \\=&amp;\\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}}(1-c(K)) \\mathbf{E}[R | \\mathbf{x}, A=k] \\=&amp;\\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}}{(1-c(K)) \\mathbf{E}[R | \\mathbf{x}, A=k]+c(K) \\sum{j = 1}^{K} \\mathbf{E}[R | \\mathbf{x}, A=j] }\\=&amp;\\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}}{\\mathbf{E}[R | \\mathbf{x}, A=k]+c(K) \\sum{j \\neq k}^{K} \\mathbf{E}[R | \\mathbf{x}, A=j]}\\=&amp;\\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}}{\\mathbf{w}{k}^{\\mathrm{T}}\\mathbf{E}[R\\mathbf{w} | \\mathbf{x}, A=k]+\\mathbf{w}{k}^{\\mathrm{T}} \\sum{j \\neq k}^{K} \\mathbf{E}[R\\mathbf{w} | \\mathbf{x}, A=j]}\\=&amp;\\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}} \\mathbf{w}{k}^{\\mathrm{T}} \\mathbf{E}\\left[\\frac{R \\mathbf{w}}{\\pi(A, \\mathbf{x})} | \\mathbf{x}\\right]:=\\underset{k \\in{1, \\ldots, K}}{\\operatorname{argmax}} \\mathbf{w}{k}^{\\mathrm{T}} \\mathbf{f}{0}(\\mathbf{x})\\end{aligned}$&emsp;&emsp;&emsp;其中，$\\mathbf{f}{0}(\\mathbf{x}) = \\mathbf{E}\\left[\\frac{R \\mathbf{w}}{\\pi(A, \\mathbf{x})} | \\mathbf{x}\\right]$，同上作出$f_{0}(\\mathbf{x})$的估计。 &emsp;&emsp;&emsp;基于角的直接学习有很好的几何解释。单位向量 $\\mathbf{w}{A}$ 代表对应治疗方案$A$，对于估计出的$\\hat{f{0}}(\\mathbf{x})$，计算其与各个 $\\mathbf{w}{A}$ 的内积，选出内积最大的 $\\mathbf{w}{A}$ 。在几何中，即选出与向量$\\hat{f{0}}(\\mathbf{x})$夹角最小的 $\\mathbf{w}{A}$ 。 参考文献 Qian, Min, and Susan A. Murphy. “PERFORMANCE GUARANTEES FOR INDIVIDUALIZED TREATMENT RULES.” Annals of Statistics 39.2 (2011): 1180-1210. Murphy, Susan A.. “Optimal dynamic treatment regimes.” Journal of The Royal Statistical Society Series B-statistical Methodology 65.2 (2003): 331-355. Schulte, Phillip J et al. “Q- and A-learning Methods for Estimating Optimal Dynamic Treatment Regimes.” Statistical science : a review journal of the Institute of Mathematical Statistics vol. 29,4 (2014): 640-661. doi:10.1214/13-STS450 Zhao, Yingqi, et al. “Estimating Individualized Treatment Rules Using Outcome Weighted Learning.” Journal of the American Statistical Association 107.499 (2012): 1106-1118. Qi, Zhengling, and Yufeng Liu. “D-learning to estimate optimal individual treatment rules.” Electronic Journal of Statistics 12.2 (2018): 3601-3638. Qi, Zhengling, et al. “Multi-Armed Angle-Based Direct Learning for Estimating Optimal Individualized Treatment Rules With Various Outcomes.” Journal of the American Statistical Association (2018): 1-33.","categories":[{"name":"文献综述","slug":"文献综述","permalink":"https://wendyliu1112.github.io/categories/%E6%96%87%E7%8C%AE%E7%BB%BC%E8%BF%B0/"}],"tags":[{"name":"因果推断","slug":"因果推断","permalink":"https://wendyliu1112.github.io/tags/%E5%9B%A0%E6%9E%9C%E6%8E%A8%E6%96%AD/"},{"name":"精准医疗","slug":"精准医疗","permalink":"https://wendyliu1112.github.io/tags/%E7%B2%BE%E5%87%86%E5%8C%BB%E7%96%97/"}]},{"title":"抽样","slug":"抽样","date":"2019-12-26T08:18:15.000Z","updated":"2020-01-18T17:51:07.834Z","comments":true,"path":"2019/12/26/抽样/","link":"","permalink":"https://wendyliu1112.github.io/2019/12/26/%E6%8A%BD%E6%A0%B7/","excerpt":"先占个位","text":"先占个位 框架基于模型基于分类","categories":[{"name":"文献综述","slug":"文献综述","permalink":"https://wendyliu1112.github.io/categories/%E6%96%87%E7%8C%AE%E7%BB%BC%E8%BF%B0/"}],"tags":[{"name":"抽样","slug":"抽样","permalink":"https://wendyliu1112.github.io/tags/%E6%8A%BD%E6%A0%B7/"}]}]}